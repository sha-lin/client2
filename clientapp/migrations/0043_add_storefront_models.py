# Generated by Django 5.2.8 on 2026-01-26 09:14

import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('clientapp', '0042_alter_client_email'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='EstimateQuote',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('estimate_id', models.CharField(editable=False, max_length=20, unique=True)),
                ('share_token', models.CharField(db_index=True, help_text='Public share token for viewing estimate', max_length=100, unique=True)),
                ('customer_name', models.CharField(max_length=255)),
                ('customer_email', models.EmailField(max_length=254)),
                ('customer_phone', models.CharField(max_length=20)),
                ('customer_company', models.CharField(blank=True, max_length=255)),
                ('line_items', models.JSONField(default=list, help_text='Line items: [{product_id, quantity, properties, notes, unit_price, line_total}]')),
                ('subtotal', models.DecimalField(decimal_places=2, default=0, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('tax_amount', models.DecimalField(decimal_places=2, default=0, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('total_amount', models.DecimalField(decimal_places=2, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))])),
                ('turnaround_time', models.CharField(choices=[('standard', 'Standard (7 days)'), ('rush', 'Rush (3 days)'), ('expedited', 'Expedited (1 day)')], default='standard', max_length=50)),
                ('delivery_method', models.CharField(blank=True, choices=[('pickup', 'Pickup'), ('courier_nairobi', 'Courier (Nairobi)'), ('courier_nationwide', 'Courier (Nationwide)')], max_length=50)),
                ('payment_terms', models.CharField(choices=[('prepaid', 'Prepaid (Full payment before production)'), ('net7', 'Net 7 Days'), ('net15', 'Net 15 Days'), ('net30', 'Net 30 Days')], default='prepaid', max_length=50)),
                ('special_notes', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('draft_unsaved', 'Draft - Not Saved'), ('shared_with_am', 'Shared with Account Manager'), ('converted_to_quote', 'Converted to Official Quote'), ('archived', 'Archived')], db_index=True, default='draft_unsaved', max_length=50)),
                ('shared_via', models.CharField(blank=True, choices=[('whatsapp', 'WhatsApp'), ('email', 'Email'), ('direct_link', 'Direct Link')], max_length=50)),
                ('share_timestamp', models.DateTimeField(blank=True, null=True)),
                ('converted_quote_id', models.CharField(blank=True, help_text='Quote ID after conversion', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('expires_at', models.DateTimeField(blank=True, help_text='Estimate expires after this date', null=True)),
                ('source', models.CharField(choices=[('storefront_public', 'Storefront - Public'), ('storefront_customer', 'Storefront - Registered Customer')], default='storefront_public', max_length=50)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['status', '-created_at'], name='clientapp_e_status_7602c3_idx'), models.Index(fields=['share_token'], name='clientapp_e_share_t_f826fa_idx'), models.Index(fields=['customer_email'], name='clientapp_e_custome_d69cc6_idx')],
            },
        ),
        migrations.CreateModel(
            name='StorefrontCustomer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.CharField(editable=False, max_length=20, unique=True)),
                ('phone', models.CharField(max_length=20)),
                ('company', models.CharField(blank=True, max_length=255)),
                ('profile_picture', models.URLField(blank=True)),
                ('email_verified', models.BooleanField(default=False)),
                ('phone_verified', models.BooleanField(default=False)),
                ('customer_type', models.CharField(choices=[('b2b', 'B2B - Business'), ('b2c', 'B2C - Retail')], default='b2b', max_length=10)),
                ('notes', models.TextField(blank=True)),
                ('communication_channel', models.CharField(choices=[('email', 'Email'), ('whatsapp', 'WhatsApp'), ('call', 'Phone Call'), ('chat', 'Chat')], default='email', max_length=50)),
                ('language', models.CharField(choices=[('en', 'English'), ('sw', 'Swahili'), ('es', 'Spanish')], default='en', max_length=10)),
                ('newsletter_subscribed', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_login', models.DateTimeField(blank=True, null=True)),
                ('linked_client', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='storefront_customer_profile', to='clientapp.client')),
                ('linked_lead', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='storefront_customer_profile', to='clientapp.lead')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='storefront_customer_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ChatbotConversation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('conversation_id', models.CharField(editable=False, max_length=100, unique=True)),
                ('session_id', models.CharField(blank=True, help_text='Session ID for anonymous users', max_length=100)),
                ('messages', models.JSONField(default=list, help_text="[{timestamp, sender: 'customer'|'bot', text, action, metadata}]")),
                ('context', models.JSONField(blank=True, default=dict, help_text='Collected info: {name, email, phone, product_interest, ...}')),
                ('started_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('ended_at', models.DateTimeField(blank=True, null=True)),
                ('resolved', models.BooleanField(default=False)),
                ('escalated_to_human', models.BooleanField(default=False)),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='escalated_chatbot_conversations', to=settings.AUTH_USER_MODEL)),
                ('related_estimate_quote', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='chatbot_conversations', to='clientapp.estimatequote')),
                ('customer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='chatbot_conversations', to='clientapp.storefrontcustomer')),
            ],
            options={
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='StorefrontMessage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('message_id', models.CharField(editable=False, max_length=20, unique=True)),
                ('customer_name', models.CharField(blank=True, max_length=255)),
                ('customer_email', models.EmailField(blank=True, max_length=254)),
                ('customer_phone', models.CharField(blank=True, max_length=20)),
                ('message_type', models.CharField(choices=[('chat', 'Chatbot Chat'), ('email_inquiry', 'Email Inquiry'), ('whatsapp_inquiry', 'WhatsApp Inquiry'), ('call_request', 'Call Request'), ('contact_form', 'Contact Form')], max_length=50)),
                ('subject', models.CharField(blank=True, max_length=255)),
                ('message_content', models.TextField()),
                ('attachments', models.JSONField(blank=True, default=list)),
                ('channel', models.CharField(choices=[('whatsapp', 'WhatsApp'), ('email', 'Email'), ('phone', 'Phone'), ('chat', 'Chat')], max_length=50)),
                ('status', models.CharField(choices=[('new', 'New'), ('in_progress', 'In Progress'), ('resolved', 'Resolved'), ('archived', 'Archived')], db_index=True, default='new', max_length=50)),
                ('response_message', models.TextField(blank=True)),
                ('response_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('assigned_to', models.ForeignKey(blank=True, help_text='Account Manager assigned to handle', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_storefront_messages', to=settings.AUTH_USER_MODEL)),
                ('customer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='messages', to='clientapp.storefrontcustomer')),
                ('related_estimate_quote', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='messages', to='clientapp.estimatequote')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='StorefrontProduct',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('product_id', models.CharField(editable=False, max_length=20, unique=True)),
                ('name', models.CharField(max_length=255)),
                ('description_short', models.CharField(blank=True, max_length=500)),
                ('description_long', models.TextField(blank=True)),
                ('category', models.CharField(db_index=True, max_length=100)),
                ('storefront_visible', models.BooleanField(db_index=True, default=True)),
                ('show_price', models.BooleanField(default=True)),
                ('base_price', models.DecimalField(decimal_places=2, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))])),
                ('price_range_min', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('price_range_max', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('pricing_tiers', models.JSONField(default=list, help_text='Quantity-based pricing: [{min_qty, max_qty, price_per_unit}]')),
                ('hero_image', models.URLField(blank=True)),
                ('gallery_images', models.JSONField(blank=True, default=list)),
                ('customization_level', models.CharField(choices=[('non_customizable', 'Non-Customizable'), ('semi_customizable', 'Semi-Customizable'), ('fully_customizable', 'Fully Customizable')], default='semi_customizable', max_length=50)),
                ('available_customizations', models.JSONField(default=dict, help_text='Available properties: {size, color, material, finish, ...}')),
                ('turnaround_standard_days', models.IntegerField(default=7)),
                ('turnaround_rush_days', models.IntegerField(default=3)),
                ('turnaround_rush_surcharge', models.DecimalField(decimal_places=2, default=1000, help_text='Additional cost for rush turnaround per item', max_digits=10)),
                ('turnaround_expedited_days', models.IntegerField(default=1)),
                ('turnaround_expedited_surcharge', models.DecimalField(decimal_places=2, default=2500, help_text='Additional cost for expedited turnaround per item', max_digits=10)),
                ('minimum_order_quantity', models.IntegerField(default=1)),
                ('featured', models.BooleanField(db_index=True, default=False)),
                ('sort_order', models.IntegerField(default=0)),
                ('rating', models.DecimalField(decimal_places=2, default=0, max_digits=3)),
                ('review_count', models.IntegerField(default=0)),
                ('published_at', models.DateTimeField(auto_now_add=True)),
                ('unpublished_at', models.DateTimeField(blank=True, null=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'ordering': ['sort_order', '-featured', 'name'],
                'indexes': [models.Index(fields=['storefront_visible', 'category'], name='clientapp_s_storefr_fac42b_idx'), models.Index(fields=['featured'], name='clientapp_s_feature_c286d9_idx'), models.Index(fields=['category'], name='clientapp_s_categor_ad695a_idx')],
            },
        ),
        migrations.CreateModel(
            name='ProductionUnit',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('unit_id', models.CharField(editable=False, max_length=30, unique=True)),
                ('unit_sequence', models.IntegerField(help_text='Order of execution (1, 2, 3, ...)')),
                ('unit_type', models.CharField(choices=[('material_sourcing', 'Material Sourcing'), ('design_preparation', 'Design Preparation'), ('production', 'Production'), ('quality_check', 'Quality Check'), ('packaging', 'Packaging'), ('delivery', 'Delivery'), ('other', 'Other')], max_length=50)),
                ('task_description', models.TextField()),
                ('quantity', models.IntegerField(validators=[django.core.validators.MinValueValidator(1)])),
                ('unit_measure', models.CharField(blank=True, default='units', max_length=50)),
                ('estimated_cost', models.DecimalField(decimal_places=2, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('actual_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('estimated_timeline_days', models.IntegerField(validators=[django.core.validators.MinValueValidator(1)])),
                ('expected_start_date', models.DateField(blank=True, null=True)),
                ('expected_end_date', models.DateField(blank=True, null=True)),
                ('actual_start_date', models.DateField(blank=True, null=True)),
                ('actual_end_date', models.DateField(blank=True, null=True)),
                ('status', models.CharField(choices=[('pending_po', 'Pending PO'), ('po_sent', 'PO Sent'), ('accepted', 'Accepted by Vendor'), ('in_progress', 'In Progress'), ('delayed', 'Delayed'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], db_index=True, default='pending_po', max_length=50)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('job', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='production_units', to='clientapp.job')),
                ('purchase_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='production_units', to='clientapp.purchaseorder')),
                ('vendor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='production_units', to='clientapp.vendor')),
            ],
            options={
                'ordering': ['job', 'unit_sequence'],
                'indexes': [models.Index(fields=['job', 'status'], name='clientapp_p_job_id_c3f135_idx'), models.Index(fields=['vendor'], name='clientapp_p_vendor__7d19ae_idx')],
                'unique_together': {('job', 'unit_sequence')},
            },
        ),
        migrations.CreateModel(
            name='QuotePricingSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('snapshot_id', models.CharField(editable=False, max_length=50, unique=True)),
                ('quote_id', models.CharField(blank=True, max_length=20)),
                ('snapshot_type', models.CharField(choices=[('estimate_created', 'Estimate Created'), ('adjusted_by_am', 'Adjusted by Account Manager'), ('approved_by_customer', 'Approved by Customer'), ('quote_created', 'Quote Created'), ('quote_adjusted', 'Quote Adjusted')], max_length=50)),
                ('base_amount', models.DecimalField(decimal_places=2, max_digits=15)),
                ('adjustments', models.JSONField(blank=True, default=dict)),
                ('total_amount', models.DecimalField(decimal_places=2, max_digits=15)),
                ('reason', models.TextField(blank=True)),
                ('snapshot_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('applied_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_pricing_snapshots', to=settings.AUTH_USER_MODEL)),
                ('estimate_quote', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='pricing_snapshots', to='clientapp.estimatequote')),
            ],
            options={
                'ordering': ['-snapshot_at'],
                'indexes': [models.Index(fields=['estimate_quote', 'snapshot_type'], name='clientapp_q_estimat_b797db_idx'), models.Index(fields=['snapshot_type'], name='clientapp_q_snapsho_6fd8f9_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='storefrontcustomer',
            index=models.Index(fields=['user'], name='clientapp_s_user_id_6de327_idx'),
        ),
        migrations.AddIndex(
            model_name='storefrontcustomer',
            index=models.Index(fields=['customer_type'], name='clientapp_s_custome_2b6c71_idx'),
        ),
        migrations.AddIndex(
            model_name='chatbotconversation',
            index=models.Index(fields=['conversation_id'], name='clientapp_c_convers_45a3ca_idx'),
        ),
        migrations.AddIndex(
            model_name='chatbotconversation',
            index=models.Index(fields=['escalated_to_human'], name='clientapp_c_escalat_f0e831_idx'),
        ),
        migrations.AddIndex(
            model_name='storefrontmessage',
            index=models.Index(fields=['status', '-created_at'], name='clientapp_s_status_ba6cac_idx'),
        ),
        migrations.AddIndex(
            model_name='storefrontmessage',
            index=models.Index(fields=['message_type'], name='clientapp_s_message_6867d5_idx'),
        ),
        migrations.AddIndex(
            model_name='storefrontmessage',
            index=models.Index(fields=['assigned_to'], name='clientapp_s_assigne_4c09ee_idx'),
        ),
    ]
