# Generated by Django 5.2.8 on 2026-01-29 18:24

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('clientapp', '0048_message_messageattachment_progressupdate_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ClientDashboard',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('total_orders', models.IntegerField(default=0)),
                ('active_orders', models.IntegerField(default=0)),
                ('completed_orders', models.IntegerField(default=0)),
                ('pending_proofs', models.IntegerField(default=0)),
                ('overdue_orders', models.IntegerField(default=0)),
                ('total_spent', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('pending_payment', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('orders_this_month', models.IntegerField(default=0)),
                ('avg_completion_days', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('on_time_delivery_rate', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('last_updated', models.DateTimeField(auto_now=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('client', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='dashboard', to='clientapp.client')),
            ],
            options={
                'verbose_name_plural': 'Client Dashboards',
            },
        ),
        migrations.CreateModel(
            name='PaymentStatus',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('amount_due', models.DecimalField(decimal_places=2, max_digits=12)),
                ('amount_paid', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('amount_pending', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('partial', 'Partially Paid'), ('paid', 'Fully Paid'), ('overdue', 'Overdue'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('due_date', models.DateField()),
                ('paid_date', models.DateField(blank=True, null=True)),
                ('payment_method', models.CharField(blank=True, choices=[('bank_transfer', 'Bank Transfer'), ('mpesa', 'M-Pesa'), ('cash', 'Cash'), ('check', 'Check'), ('credit_card', 'Credit Card')], max_length=20, null=True)),
                ('days_overdue', models.IntegerField(default=0)),
                ('is_overdue', models.BooleanField(default=False)),
                ('last_payment_date', models.DateField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('client_invoice', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='payment_status', to='clientapp.clientinvoice')),
            ],
            options={
                'ordering': ['due_date'],
            },
        ),
        migrations.CreateModel(
            name='PaymentHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('payment_amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('payment_date', models.DateField()),
                ('reference_number', models.CharField(help_text='Bank reference, M-Pesa ref, etc', max_length=100)),
                ('payment_method', models.CharField(choices=[('bank_transfer', 'Bank Transfer'), ('mpesa', 'M-Pesa'), ('cash', 'Cash'), ('check', 'Check'), ('credit_card', 'Credit Card')], max_length=20)),
                ('bank_account', models.CharField(blank=True, max_length=50, null=True)),
                ('depositor_name', models.CharField(blank=True, max_length=255, null=True)),
                ('notes', models.TextField(blank=True, help_text='Internal notes about this payment')),
                ('reconciled', models.BooleanField(default=False)),
                ('reconciled_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='payments_recorded', to=settings.AUTH_USER_MODEL)),
                ('reconciled_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reconciled_payments', to=settings.AUTH_USER_MODEL)),
                ('payment_status', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payment_history', to='clientapp.paymentstatus')),
            ],
            options={
                'ordering': ['-payment_date'],
            },
        ),
        migrations.CreateModel(
            name='PerformanceAnalytics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('month', models.DateField(help_text='First day of month for this metric')),
                ('orders_completed', models.IntegerField(default=0)),
                ('orders_on_time', models.IntegerField(default=0)),
                ('orders_late', models.IntegerField(default=0)),
                ('quality_score', models.DecimalField(decimal_places=2, default=0, help_text='0-100 scale', max_digits=5)),
                ('proofs_approved_first_attempt', models.IntegerField(default=0)),
                ('revision_requests', models.IntegerField(default=0)),
                ('rejection_rate', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('avg_turnaround_hours', models.DecimalField(decimal_places=2, default=0, max_digits=6)),
                ('on_time_delivery_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('avg_cost_per_unit', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('cost_variance_percentage', models.DecimalField(decimal_places=2, default=0, help_text='vs average', max_digits=5)),
                ('communication_score', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('reliability_score', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('overall_trend', models.CharField(choices=[('up', 'Improving ↑'), ('down', 'Declining ↓'), ('stable', 'Stable →')], default='stable', max_length=10)),
                ('trend_description', models.CharField(blank=True, max_length=255)),
                ('ranking', models.IntegerField(blank=True, help_text='Rank among all vendors this month', null=True)),
                ('percentile', models.DecimalField(blank=True, decimal_places=2, help_text='Percentile 0-100', max_digits=5, null=True)),
                ('calculated_at', models.DateTimeField(auto_now=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('vendor', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='performance_analytics', to='clientapp.vendor')),
            ],
            options={
                'verbose_name_plural': 'Performance Analytics',
                'ordering': ['-month', '-overall_trend'],
            },
        ),
        migrations.CreateModel(
            name='VendorComparison',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('comparison_date', models.DateField(auto_now_add=True)),
                ('quality_score_1', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('quality_score_2', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('avg_cost_1', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('avg_cost_2', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('avg_turnaround_1', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('avg_turnaround_2', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('on_time_rate_1', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('on_time_rate_2', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('overall_score_1', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('overall_score_2', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('winner', models.CharField(blank=True, choices=[('vendor1', 'Vendor 1'), ('vendor2', 'Vendor 2'), ('tie', 'Tie')], max_length=10, null=True)),
                ('reason', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='vendor_comparisons', to='clientapp.client')),
                ('vendor1', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='comparisons_as_vendor1', to='clientapp.vendor')),
                ('vendor2', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='comparisons_as_vendor2', to='clientapp.vendor')),
            ],
            options={
                'verbose_name_plural': 'Vendor Comparisons',
                'ordering': ['-comparison_date'],
            },
        ),
        migrations.CreateModel(
            name='ClientFeedback',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('feedback_type', models.CharField(choices=[('quality', 'Quality'), ('cost', 'Cost/Pricing'), ('timeline', 'Timeline/Delivery'), ('vendor', 'Vendor Performance'), ('general', 'General Feedback')], max_length=20)),
                ('rating', models.IntegerField(choices=[(1, '1'), (2, '2'), (3, '3'), (4, '4'), (5, '5')], help_text='1 = Poor, 5 = Excellent')),
                ('comment', models.TextField(blank=True, help_text='Detailed feedback or comments')),
                ('is_addressed', models.BooleanField(default=False, help_text='Whether PT has addressed this feedback')),
                ('response', models.TextField(blank=True, help_text='PT response to feedback')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='feedback_given', to='clientapp.client')),
                ('order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='client_feedback', to='clientapp.order')),
                ('proof', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='client_feedback', to='clientapp.proofsubmission')),
                ('vendor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='client_feedback', to='clientapp.vendor')),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['order', 'created_at'], name='clientapp_c_order_i_9ed866_idx'), models.Index(fields=['client', 'created_at'], name='clientapp_c_client__e98d1f_idx'), models.Index(fields=['vendor', 'rating'], name='clientapp_c_vendor__5585e7_idx')],
            },
        ),
        migrations.CreateModel(
            name='ClientMessage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('sender_type', models.CharField(choices=[('client', 'Client'), ('staff', 'PT Staff')], max_length=10)),
                ('message', models.TextField()),
                ('attachment', models.FileField(blank=True, null=True, upload_to='client_messages/%Y/%m/%d/')),
                ('is_read', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('read_at', models.DateTimeField(blank=True, null=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='client_messages', to='clientapp.order')),
                ('sender', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='client_messages_sent', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['created_at'],
                'indexes': [models.Index(fields=['order', 'created_at'], name='clientapp_c_order_i_82dc99_idx'), models.Index(fields=['sender', 'created_at'], name='clientapp_c_sender__387744_idx')],
            },
        ),
        migrations.CreateModel(
            name='ClientNotification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255)),
                ('message', models.TextField()),
                ('notification_type', models.CharField(choices=[('order_update', 'Order Update'), ('proof_ready', 'Proof Ready'), ('message', 'New Message'), ('payment', 'Payment Notice'), ('alert', 'Alert'), ('system', 'System Notification')], max_length=20)),
                ('is_read', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('read_at', models.DateTimeField(blank=True, null=True)),
                ('link', models.URLField(blank=True, help_text='Link to related order or resource', null=True)),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to='clientapp.client')),
                ('order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='notifications', to='clientapp.order')),
                ('proof', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='notifications', to='clientapp.proofsubmission')),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['client', '-created_at'], name='clientapp_c_client__80bd56_idx'), models.Index(fields=['client', 'is_read'], name='clientapp_c_client__b2c4ed_idx')],
            },
        ),
        migrations.CreateModel(
            name='OrderMetrics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('month', models.DateField(help_text='First day of month for this metric')),
                ('total_orders', models.IntegerField(default=0)),
                ('completed_orders', models.IntegerField(default=0)),
                ('pending_orders', models.IntegerField(default=0)),
                ('cancelled_orders', models.IntegerField(default=0)),
                ('total_value', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('avg_order_value', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('total_revenue', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('avg_turnaround_days', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('on_time_delivery_rate', models.DecimalField(decimal_places=2, default=0, help_text='Percentage 0-100', max_digits=5)),
                ('completion_rate', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('avg_quality_score', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('proofs_approved_first_attempt', models.IntegerField(default=0)),
                ('revision_requests', models.IntegerField(default=0)),
                ('calculated_at', models.DateTimeField(auto_now=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='order_metrics', to='clientapp.client')),
            ],
            options={
                'verbose_name_plural': 'Order Metrics',
                'ordering': ['-month'],
                'indexes': [models.Index(fields=['client', 'month'], name='clientapp_o_client__4795f3_idx'), models.Index(fields=['month'], name='clientapp_o_month_f38290_idx')],
                'unique_together': {('client', 'month')},
            },
        ),
        migrations.AddIndex(
            model_name='paymentstatus',
            index=models.Index(fields=['status', 'due_date'], name='clientapp_p_status_a58462_idx'),
        ),
        migrations.AddIndex(
            model_name='paymentstatus',
            index=models.Index(fields=['client_invoice', 'status'], name='clientapp_p_client__a1a510_idx'),
        ),
        migrations.AddIndex(
            model_name='paymenthistory',
            index=models.Index(fields=['payment_status', 'payment_date'], name='clientapp_p_payment_2fff46_idx'),
        ),
        migrations.AddIndex(
            model_name='paymenthistory',
            index=models.Index(fields=['reference_number'], name='clientapp_p_referen_fd651a_idx'),
        ),
        migrations.AddIndex(
            model_name='performanceanalytics',
            index=models.Index(fields=['vendor', 'month'], name='clientapp_p_vendor__f064f2_idx'),
        ),
        migrations.AddIndex(
            model_name='performanceanalytics',
            index=models.Index(fields=['month', 'ranking'], name='clientapp_p_month_53f7c9_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='performanceanalytics',
            unique_together={('vendor', 'month')},
        ),
        migrations.AddIndex(
            model_name='vendorcomparison',
            index=models.Index(fields=['client', 'comparison_date'], name='clientapp_v_client__56fe45_idx'),
        ),
        migrations.AddIndex(
            model_name='vendorcomparison',
            index=models.Index(fields=['vendor1', 'vendor2'], name='clientapp_v_vendor1_82e2a6_idx'),
        ),
    ]
