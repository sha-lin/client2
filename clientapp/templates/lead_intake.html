{% extends 'base.html' %}

{% block title %}Lead Intake - Client MIS{% endblock %}

{% block content %}
<div>
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-semibold text-gray-900">Lead Intake & Qualification</h1>
            <p class="text-gray-600">Quick capture and qualification of prospects</p>
        </div>
        <button onclick="openModal('newLeadModal')" class="btn btn-primary flex items-center gap-2">
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            New Lead
        </button>
    </div>
    
    <div class="card">
        <div class="border-b border-gray-200 px-6 py-4">
            <h3 class="text-lg font-semibold">Lead Tracking</h3>
            <p class="text-sm text-gray-600">Search and manage your leads</p>
        </div>
        <div class="p-6 space-y-4">
            <!-- Search -->
            <div class="flex items-center gap-2">
                <svg class="w-4 h-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
                <input type="text" id="searchInput" placeholder="Search by name, email, or ID..." class="form-input max-w-sm">
            </div>
            
            <!-- Table -->
            <div id="leadsTableContainer" class="border border-gray-200 rounded-lg overflow-hidden">
                <table>
                    <thead class="bg-gray-50">
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Contact</th>
                            <th>Source</th>
                            <th>Product Interest</th>
                            <th>Follow-up</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="leadsTableBody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div id="noLeadsMessage" class="text-center text-gray-500 py-8 hidden">No leads found</div>
        </div>
    </div>
</div>

<!-- New Lead Modal -->
<div id="newLeadModal" class="modal">
    <div class="modal-content max-w-2xl">
        <div class="border-b border-gray-200 pb-4 mb-4">
            <h2 class="text-xl font-semibold">Create New Lead</h2>
            <p class="text-sm text-gray-600">Capture prospect information and qualification details</p>
        </div>
        
        <form id="lead-form">
            <div id="duplicate-warning" class="hidden mb-4"></div>
            
            <!-- Basic Information -->
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-700 mb-3">Contact Information</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-sm font-medium">Name / Company *</label>
                        <input type="text" name="name" id="leadName" required placeholder="Company or contact name" class="form-input">
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium">Email</label>
                        <input type="email" name="email" id="leadEmail" placeholder="email@company.com" class="form-input">
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium">Phone *</label>
                        <input type="tel" name="phone" id="leadPhone" required placeholder="+1 (555) 000-0000" class="form-input">
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium">Preferred Contact</label>
                        <select name="preferred_contact" id="leadPreferredContact" class="form-input">
                            <option value="Email">Email</option>
                            <option value="Phone">Phone</option>
                            <option value="WhatsApp">WhatsApp</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Qualification Information -->
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-700 mb-3">Qualification</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-sm font-medium">Lead Source</label>
                        <select name="source" id="leadSource" class="form-input">
                            <option value="">-- Select Source --</option>
                            <option value="Website">Website</option>
                            <option value="Referral">Referral</option>
                            <option value="Cold Call">Cold Call</option>
                            <option value="Social Media">Social Media</option>
                            <option value="Event">Event</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium">Client Type</label>
                        <select name="preferred_client_type" id="leadClientType" class="form-input">
                            <option value="B2B">B2B Business</option>
                            <option value="B2C">B2C Retail</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium">Product Interest</label>
                        <div class="relative" id="productSelectContainer">
                            <input type="hidden" name="product_interest" id="leadProductInterest" />
                            <button type="button" id="productDropdownBtn" class="form-input w-full text-left flex justify-between items-center bg-white cursor-pointer">
                                <span id="selectedProductsText" class="text-gray-500">Select products...</span>
                                <svg class="w-4 h-4 text-gray-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="productDropdownMenu" class="hidden absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                                <div class="sticky top-0 bg-white border-b p-2">
                                    <input type="text" id="productSearch" placeholder="Search products..." class="form-input w-full text-sm">
                                </div>
                                <div id="productList" class="divide-y">
                                    <div class="p-4 text-center text-gray-500">Loading products...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium">Follow-up Date</label>
                        <input type="date" name="follow_up_date" id="leadFollowUpDate" class="form-input">
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-700 mb-3">Additional Information</h3>
                <div class="space-y-2">
                    <label class="text-sm font-medium">Notes</label>
                    <textarea name="notes" id="leadNotes" rows="3" placeholder="Any additional information about the lead..." class="form-input"></textarea>
                </div>
            </div>
            
            <div class="flex gap-2 justify-end pt-4 border-t border-gray-200">
                <button type="button" onclick="closeModal('newLeadModal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Lead</button>
            </div>
        </form>
    </div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/lead-intake.js?v=20260128"></script>
{% endblock %}
