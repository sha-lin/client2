{% extends "admin/base_dashboard.html" %}
{% load static %}

{% block header_title %}System Settings{% endblock %}

{% block extrahead %}
<style>
    .settings-container { max-width: 1000px; margin: 0 auto; }
    
    .settings-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        border: 1px solid #e2e8f0;
        overflow: hidden;
    }
    
    .settings-tabs {
        display: flex;
        border-bottom: 1px solid #e2e8f0;
        background: #f8fafc;
    }
    
    .tab-btn {
        padding: 15px 25px;
        border: none;
        background: none;
        font-weight: 600;
        color: #64748b;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
    }
    
    .tab-btn:hover { color: #1e293b; }
    .tab-btn.active { color: #3b82f6; border-bottom-color: #3b82f6; background: white; }
    
    .tab-content { padding: 30px; display: none; }
    .tab-content.active { display: block; }
    
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: #334155; }
    .form-control {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        font-size: 0.95rem;
        transition: border-color 0.2s;
    }
    .form-control:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
    
    .toggle-switch {
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
    }
    .toggle-input { display: none; }
    .toggle-slider {
        width: 44px;
        height: 24px;
        background: #cbd5e1;
        border-radius: 12px;
        position: relative;
        transition: 0.3s;
    }
    .toggle-slider::before {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: 0.3s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .toggle-input:checked + .toggle-slider { background: #3b82f6; }
    .toggle-input:checked + .toggle-slider::before { transform: translateX(20px); }
    
    .btn-save {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }
    .btn-save:hover { background: #2563eb; }
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <form method="post" class="settings-card">
        {% csrf_token %}
        
        <div class="settings-tabs">
            <button type="button" class="tab-btn active" onclick="openTab(event, 'general')">General</button>
            <button type="button" class="tab-btn" onclick="openTab(event, 'notifications')">Notifications</button>
            <button type="button" class="tab-btn" onclick="openTab(event, 'security')">Security</button>
        </div>

        <!-- General Settings -->
        <div id="general" class="tab-content active">
            <div class="form-group">
                <label class="form-label">Site Title</label>
                <input type="text" name="site_title" class="form-control" value="{{ system_settings.site_title }}">
            </div>
            
            <div class="row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label class="form-label">Support Email</label>
                    <input type="email" name="support_email" class="form-control" value="{{ system_settings.support_email }}">
                </div>
                <div class="form-group">
                    <label class="form-label">Default Currency</label>
                    <select name="currency" class="form-control">
                        <option value="KES" selected>KES (Kenyan Shilling)</option>
                        <option value="USD">USD (US Dollar)</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Timezone</label>
                <select name="timezone" class="form-control">
                    <option value="Africa/Nairobi" selected>Africa/Nairobi (GMT+3)</option>
                    <option value="UTC">UTC</option>
                </select>
            </div>

            <div class="form-group" style="margin-top: 30px;">
                <label class="toggle-switch">
                    <input type="checkbox" name="maintenance_mode" class="toggle-input" {% if system_settings.maintenance_mode %}checked{% endif %}>
                    <div class="toggle-slider"></div>
                    <div>
                        <div style="font-weight: 500;">Maintenance Mode</div>
                        <div style="font-size: 0.85rem; color: #64748b;">Only admins can access the site when enabled</div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Notification Settings -->
        <div id="notifications" class="tab-content">
            <div class="form-group">
                <label class="toggle-switch">
                    <input type="checkbox" name="email_on_order" class="toggle-input" checked>
                    <div class="toggle-slider"></div>
                    <div>
                        <div style="font-weight: 500;">New Order Alerts</div>
                        <div style="font-size: 0.85rem; color: #64748b;">Receive email when a new LPO is created</div>
                    </div>
                </label>
            </div>
            
            <div class="form-group">
                <label class="toggle-switch">
                    <input type="checkbox" name="email_on_quote" class="toggle-input" checked>
                    <div class="toggle-slider"></div>
                    <div>
                        <div style="font-weight: 500;">Quote Approval Alerts</div>
                        <div style="font-size: 0.85rem; color: #64748b;">Receive email when a client approves a quote</div>
                    </div>
                </label>
            </div>

            <div class="form-group">
                <label class="toggle-switch">
                    <input type="checkbox" name="daily_digest" class="toggle-input">
                    <div class="toggle-slider"></div>
                    <div>
                        <div style="font-weight: 500;">Daily Digest</div>
                        <div style="font-size: 0.85rem; color: #64748b;">Receive a daily summary of all activities at 8:00 AM</div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Security Settings -->
        <div id="security" class="tab-content">
            <div class="form-group">
                <label class="toggle-switch">
                    <input type="checkbox" name="allow_registration" class="toggle-input" checked>
                    <div class="toggle-slider"></div>
                    <div>
                        <div style="font-weight: 500;">Allow Public Registration</div>
                        <div style="font-size: 0.85rem; color: #64748b;">If disabled, only admins can create new user accounts</div>
                    </div>
                </label>
            </div>
            
            <div class="form-group">
                <label class="form-label">Session Timeout (Minutes)</label>
                <input type="number" name="session_timeout" class="form-control" value="60">
            </div>
        </div>

        <div style="padding: 20px 30px; background: #f8fafc; border-top: 1px solid #e2e8f0; text-align: right;">
            <button type="submit" class="btn-save">Save Changes</button>
        </div>
    </form>
</div>

<script>
    function openTab(evt, tabName) {
        var i, tabContent, tabBtn;
        
        tabContent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabContent.length; i++) {
            tabContent[i].style.display = "none";
            tabContent[i].classList.remove("active");
        }
        
        tabBtn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tabBtn.length; i++) {
            tabBtn[i].className = tabBtn[i].className.replace(" active", "");
        }
        
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.className += " active";
    }
</script>
{% endblock %}